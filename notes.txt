//Random notes

//The new like box that can be used
<div class="fb-like-box" data-href="<?php echo $branch_fb_url; ?>" data-show-faces=<?= $fb_url_settings[0] ?> data-header=<?= $fb_url_settings[1] ?> data-stream=<?= $fb_url_settings[2] ?> data-show-border=<?= $fb_url_settings[3] ?> data-colorscheme=<?= $fb_url_settings[4] ?>></div>



<!DOCTYPE html>
<html>
<head>
    <title>Facebook Login JavaScript Example</title>
    <meta charset="UTF-8">
</head>
<body>
<script>
    // This is called with the results from from FB.getLoginStatus().
    function statusChangeCallback(response) {
        console.log('statusChangeCallback');
        console.log(response);
        // The response object is returned with a status field that lets the
        // app know the current login status of the person.
        // Full docs on the response object can be found in the documentation
        // for FB.getLoginStatus().
        if (response.status === 'connected') {
            // Logged into your app and Facebook.
            testAPI();
        } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into this app.';
        } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into Facebook.';
        }
    }

    // This function is called when someone finishes with the Login
    // Button.  See the onlogin handler attached to it in the sample
    // code below.
    function checkLoginState() {
        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });
    }

    window.fbAsyncInit = function() {
        FB.init({
            appId      : '282363058604879',
            cookie     : true,  // enable cookies to allow the server to access
            // the session
            xfbml      : true,  // parse social plugins on this page
            version    : 'v2.1' // use version 2.1
        });

        // Now that we've initialized the JavaScript SDK, we call
        // FB.getLoginStatus().  This function gets the state of the
        // person visiting this page and can return one of three states to
        // the callback you provide.  They can be:
        //
        // 1. Logged into your app ('connected')
        // 2. Logged into Facebook, but not your app ('not_authorized')
        // 3. Not logged into Facebook and can't tell if they are logged into
        //    your app or not.
        //
        // These three cases are handled in the callback function.

        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });

    };

    // Load the SDK asynchronously
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // Here we run a very simple test of the Graph API after login is
    // successful.  See statusChangeCallback() for when this call is made.
    function testAPI() {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', function(response) {
            console.log('Successful login for: ' + response.name);
            document.getElementById('status').innerHTML =
                'Thanks for logging in, ' + response.name + '!';
            //window.location = 'https://www.google.com/';
        });
    }
</script>

<!--
Below we include the Login Button social plugin. This button uses
  the JavaScript SDK to present a graphical Login button that triggers
  the FB.login() function when clicked.
-->

<h1>Header</h1>

<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
</fb:login-button>

<div id="status">
</div>

</body>
</html>









----




<?php
//Start of controller




//End of controller
?>

<!DOCTYPE html>
<html>
<head>
    <title>Walmart GDL WiFi gratis</title>
    <meta charset="UTF-8">
</head>
<body>
<script>
    // This is called with the results from from FB.getLoginStatus().
    function statusChangeCallback(response) {
        console.log('statusChangeCallback');
        console.log(response);
        // The response object is returned with a status field that lets the
        // app know the current login status of the person.
        // Full docs on the response object can be found in the documentation
        // for FB.getLoginStatus().
        if (response.status === 'connected') {
            // Logged into your app and Facebook.
            testAPI();
        } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into this app.';
        } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into Facebook.';
        }
    }

    // This function is called when someone finishes with the Login
    // Button.  See the onlogin handler attached to it in the sample
    // code below.
    function checkLoginState() {
        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });
    }

    window.fbAsyncInit = function() {
        FB.init({
            appId      : '282363058604879',
            cookie     : true,  // enable cookies to allow the server to access
            // the session
            xfbml      : true,  // parse social plugins on this page
            version    : 'v2.1' // use version 2.1
        });

        // Now that we've initialized the JavaScript SDK, we call
        // FB.getLoginStatus().  This function gets the state of the
        // person visiting this page and can return one of three states to
        // the callback you provide.  They can be:
        //
        // 1. Logged into your app ('connected')
        // 2. Logged into Facebook, but not your app ('not_authorized')
        // 3. Not logged into Facebook and can't tell if they are logged into
        //    your app or not.
        //
        // These three cases are handled in the callback function.

        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });

    };

    // Load the SDK asynchronously
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // Here we run a very simple test of the Graph API after login is
    // successful.  See statusChangeCallback() for when this call is made.
    function testAPI() {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', function(response) {
            console.log('Successful login for: ' + response.name);
            document.getElementById('status').innerHTML =
                'Thanks for logging in, ' + response.name + '!';
        });
    }
</script>

<!--
  Below we include the Login Button social plugin. This button uses
  the JavaScript SDK to present a graphical Login button that triggers
  the FB.login() function when clicked.
-->
<h1>Test</h1>

<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
</fb:login-button>

<div id="status">
</div>

<div>
    <table style="width:100%">
        <tr>
            <h1>tr1</h1>
        </tr>
        <tr>
            <h1>tr2</h1>
        </tr>
        <tr>
            <h1>tr3</h1>
        </tr>

    </table>
</div>

</body>
</html>






------




<?php
//Start of controller
require_once 'autoload.php';

date_default_timezone_set('America/Mexico_City');
session_start();

use Facebook\FacebookSession;
use Facebook\FacebookRedirectLoginHelper;
use Facebook\FacebookJavaScriptLoginHelper;
use Facebook\FacebookRequest;
use Facebook\FacebookRequestException;
use Facebook\GraphUser;
use Facebook\FacebookResponse;
use Facebook\FacebookSDKException;
use Facebook\FacebookAuthorizationException;
use Facebook\GraphObject;
use Facebook\Entities\AccessToken;
use Facebook\HttpClients\FacebookCurlHttpClient;
use Facebook\HttpClients\FacebookHttpable;

FacebookSession::setDefaultApplication('282363058604879','b61e5fe63f4c5e0544ad94684a9c3ec9');
$helper = new FacebookRedirectLoginHelper('https://enera-intelligence.mx/portal_development3/logged_in.php');
$loginUrl = $helper->getLoginUrl();

//End of controller
?>
<!DOCTYPE html>
<html>
<head>
    <!-- Meta setup - Required for apple device -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<!-- Favicon -->
	<link rel="icon" type="image/png" href="project/img/welcome/favicon.png" />
    <!-- Title -->
    <title>Walmart Free WiFi</title>
	<!-- Include fonts -->
	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
    <!-- Include webplate -->
    <script id="webplate-stack" src="stack.js"></script>
    <!-- Portal custom CSS -->
    <link href='css/portal_styles.css' rel='stylesheet' type='text/css'>
</head>
<body style="display: none;" data-icon-font="icomoon" data-ui="stripe" data-project-css="welcome.css" data-project-js="min/welcome.min.js" data-formplate-colour="aqua" class="invert">
	<!-- Header -->
	<header class="stripe full">
		<!-- <a href="#" class="navigation-trigger icon-menu"></a> -->
		<div class="contain">
			<div class="text-center-tight">
                <div class="inner">
                    <a href="<?php echo $loginUrl; ?>">Accept and continue</a>
                    <img id="logo" src="images/999.png" alt="No image found."/>
                    <br/>
                    <h2>Hey there!</h2>
                    <br/>
                    <p style="color: white;">Welcome to Walmart Guadalajara! Press Log In to get free internet access.</p>
                    <br/>
                    <fb:login-button scope="public_profile,email,user_likes" onlogin="checkLoginState();"></fb:login-button>
                    <p id="status" style="color: white;">Please log into Facebook</p>
                </div>
            </div>
			<!-- <a href="#" class="scroll-down icon-angle-down"></a> -->
		</div>
		<div class="bg-image"></div>
	</header>

	<!-- Footer -->
	<div class="stripe dark padding-3" id="footer">
        <div class="contain text-center">
            <p style="font-size: 12px; font-family: Helvetica, 'Trebuchet MS', sans-serif">See our <a href="ap.php">Privacy Policy</a>.</p>
            <h5>Enera Free WiFi</h5>
        </div>
    </div>
</body>
</html>





------




<a href="<?php echo $loginUrl; ?>" onclick="window.open(this.href,'targetWindow', 'scrollbars=yes, resizable=yes, width=600, height=800'); return false;">Accept and continue</a>




----login buttons

                <a class="btn-auth btn-facebook" href="<?php echo $loginUrl; ?>">Sign in with <b>Facebook</b></a>
                <!-- <p id="status" style="color: white;">Please log into Facebook</p> -->
                <a href="<?php echo $loginUrl; ?>" onclick="javascript:void window.open('<?php echo $loginUrl; ?>','fb_popup','width=600,height=300,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=0,left=0,top=0');return false;">Login with Facebook</a>

---- loggedin funcionando con php sdk
<?php
//Start of controller
require_once 'autoload.php';

//date_default_timezone_set('America/Mexico_City');
session_start();

use Facebook\FacebookSession;
use Facebook\FacebookRequest;
use Facebook\FacebookRequestException;
use Facebook\GraphUser;
use Facebook\FacebookRedirectLoginHelper;
use Facebook\FacebookJavaScriptLoginHelper;
use Facebook\FacebookResponse;
use Facebook\FacebookSDKException;
use Facebook\FacebookAuthorizationException;
use Facebook\GraphObject;
use Facebook\Entities\AccessToken;
use Facebook\HttpClients\FacebookCurlHttpClient;
use Facebook\HttpClients\FacebookHttpable;

//List of available promotions (TODO: This information should be obtained from a database instead of a variable)
$all_promotions = array(
    "J.K. Rowling" => "<div class='image' data-wallpaper='http://www.jkrowling.com/uploads/images/large/en_US-timeline-image-harry-potter-and-the-deathly-hallows-1333632499.jpg'></div><div class='text'><p>Harry Potter series 50%</p></div>",
    "Suzanne Collins" => "<div class='image' data-wallpaper='http://upload.wikimedia.org/wikipedia/en/a/ab/Hunger_games.jpg'></div><div class='text'><p>Hunger Games 5% discount</p></div>",
    "Angry Birds" => "<div class='image' data-wallpaper='http://mcdn4.angrybirdsnest.com/wp-content/uploads/2011/12/Angry-Birds-Seasons-Christmas-Comic-Part-25.jpg'></div><div class='text'><p>Buy Angry Birds and get a free Angry X-Mas bird card</p></div>",
    "Facebook" => "<div class='image' data-wallpaper='http://ecx.images-amazon.com/images/I/51i8emtv9PL._SX258_BO1,204,203,200_.jpg'></div><div class='text'><p>Buy the book \"Ultimate Guide to Facebook Advertising: How to <br/>Access 1 Billion Potential Customers in 10 Minutes\" (Ultimate Series)</p></div>",
);

$selected_promotions = array();
array_push($selected_promotions, $all_promotions['Facebook']);

// init app with app id and secret
FacebookSession::setDefaultApplication('282363058604879','b61e5fe63f4c5e0544ad94684a9c3ec9');

//$helper = new FacebookRedirectLoginHelper();

$helper = new FacebookRedirectLoginHelper('https://enera-intelligence.mx/portal_development3/logged_in.php');

try {
    $session = $helper->getSessionFromRedirect();
} catch(FacebookRequestException $ex) {
    // When Facebook returns an error
    //echo "ex $ex";
} catch(\Exception $ex) {
    // When validation fails or other local issues
    //echo "ex $ex";
}

if ($session) {
    //Logged in
    try {
        //Get profile main info
        $user_profile = (new FacebookRequest($session, 'GET', '/me'))->execute()->getGraphObject(GraphUser::className())->asArray();
        $user_name = $user_profile['name'];

        //Get profile likes
        $user_likes = (new FacebookRequest($session, 'GET', '/me/likes/'))->execute()->getGraphObject()->asArray();
        $user_likes = $user_likes['data'];
        //var_dump($user_likes['data'][0]->name);
    } catch(FacebookRequestException $e) {
        //echo "Exception occured, code: " . $e->getCode();
        //echo " with message: " . $e->getMessage();
    }

    //Process fb_user_likes variable to get the recommendations
    foreach($all_promotions as $key => $promotion) {
        foreach ($user_likes as $user_like) {
            //echo "---" . $user_like['name'];
            if ($key == $user_like->name)
            {
                array_push($selected_promotions, $promotion);
            }
        }
    }
}

//End of controller
?>
<!DOCTYPE html>
<html>
<head>
    <!-- Meta setup - Required for apple device -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="project/img/welcome/favicon.png" />
    <!-- Title -->
    <title>Walmart Free WiFi</title>
    <!-- Include fonts -->
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
    <!-- Include webplate -->
    <script id="webplate-stack" src="stack.js"></script>
    <!-- Portal custom CSS -->
    <link href='css/portal_styles.css' rel='stylesheet' type='text/css'>
</head>
<body style="display: none;" data-icon-font="icomoon" data-ui="stripe" data-project-css="welcome.css" data-project-js="min/welcome.min.js" data-formplate-colour="aqua" class="invert">

<!-- Facebook like box -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=550968091700617&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

<!-- Header -->
<header class="stripe full">
    <!-- <a href="#" class="navigation-trigger icon-menu"></a> -->
    <div class="contain">
        <div class="text-center-tight">
            <div class="inner">
                <img id="logo" src="images/999.png" alt="No image found."/>
                <br/>
                <h2>Welcome <span id="user_name" style="color: white;"></span>!</h2>
                <p style="color: white;">Please like our Facebook page (optional):</p>
                <div class="fb-like-box" data-href="https://www.facebook.com/walmart" data-width="200" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="false" data-show-border="false"></div>
                <br/>
                <p style="color: white;">And scroll down<br/>to continue</p>
            </div>
        </div>
        <a href="#" class="scroll-down icon-angle-down" style="left: 90%;"></a>
    </div>
    <div class="bg-image"></div>
</header>

<!-- Showcase -->
<div class="stripe" id="stripe-showcase"><div class="contain">
        <h3>You might be interested in these products:</h3>
        <div class="showcase-list">
            <?php
            foreach ($selected_promotions as $promotion)
            {
                echo "<a href='#' class='showcase'>";
                echo $promotion;
                echo "</a>";
            }
            ?>
        </div>
    </div></div>

<!-- Footer -->
<div class="stripe dark" id="footer">
    <div class="contain">
        <a href="https://www.google.com/" class="button extra-large">Continue</a>
    </div>
</div>
</body>
</html>



--- cambio rapido de index


<?php
//Start of controller
session_start();
date_default_timezone_set('America/Mexico_City');

//End of controller
?>
<!DOCTYPE html>
<html>
<head>
    <!-- Meta setup - Required for apple device -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="project/img/welcome/favicon.png" />
    <!-- Title -->
    <title>Walmart Free WiFi</title>
    <!-- Include fonts -->
    <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
    <!-- Include webplate -->
    <script id="webplate-stack" src="stack.js"></script>
    <!-- Portal custom CSS -->
    <link href='css/portal_styles.css' rel='stylesheet' type='text/css'>
    <!-- Login buttons -->
    <link href='css/auth-buttons.css' rel='stylesheet' type='text/css'>
</head>
<body style="display: none;" data-icon-font="icomoon" data-ui="stripe" data-project-css="welcome.css" data-project-js="min/welcome.min.js" data-formplate-colour="aqua" class="invert">
<!-- Facebook script -->
<script>
    // This is called with the results from from FB.getLoginStatus().
    function statusChangeCallback(response) {
        console.log('statusChangeCallback');
        console.log(response);
        // The response object is returned with a status field that lets the
        // app know the current login status of the person.
        // Full docs on the response object can be found in the documentation
        // for FB.getLoginStatus().
        if (response.status === 'connected') {
            // Logged into your app and Facebook.
            console.log('Logged');
            testAPI();
        } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into this app.';
        } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            document.getElementById('status').innerHTML = 'Please log ' +
                'into Facebook.';
        }
    }

    // This function is called when someone finishes with the Login
    // Button.  See the onlogin handler attached to it in the sample
    // code below.
    function checkLoginState() {
        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });
    }

    window.fbAsyncInit = function() {
        FB.init({
            appId      : '282363058604879',
            cookie     : true,  // enable cookies to allow the server to access
            // the session
            xfbml      : true,  // parse social plugins on this page
            version    : 'v2.1' // use version 2.1
        });

        // Now that we've initialized the JavaScript SDK, we call
        // FB.getLoginStatus().  This function gets the state of the
        // person visiting this page and can return one of three states to
        // the callback you provide.  They can be:
        //
        // 1. Logged into your app ('connected')
        // 2. Logged into Facebook, but not your app ('not_authorized')
        // 3. Not logged into Facebook and can't tell if they are logged into
        //    your app or not.
        //
        // These three cases are handled in the callback function.

        FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
        });

    };

    // Load the SDK asynchronously
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // Here we run a very simple test of the Graph API after login is
    // successful.  See statusChangeCallback() for when this call is made.
    function testAPI() {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', function(response) {
            console.log('Successful login for: ' + response.name);
            document.getElementById('status').innerHTML =
                'Thanks for logging in, ' + response.name + '!';
        });
        FB.api('/me/likes', function(response) {
            console.log(response);
            //TODO: Make aa conditional to check if this exists
            matchPromotions();
        });
    }

    //TODO: For testing purposes only, change to the AJAX call to PHP from captive portal instead for a faster response...
    function matchPromotions() {
        var all_promotions = [
            "Facebook||<div class='image' data-wallpaper='http://ecx.images-amazon.com/images/I/51i8emtv9PL._SX258_BO1,204,203,200_.jpg'></div><div class='text'><p>Buy the book \"Ultimate Guide to Facebook Advertising: How to <br/>Access 1 Billion Potential Customers in 10 Minutes\" (Ultimate Series)</p></div>",
            "J.K. Rowling||<div class='image' data-wallpaper='http://www.jkrowling.com/uploads/images/large/en_US-timeline-image-harry-potter-and-the-deathly-hallows-1333632499.jpg'></div><div class='text'><p>Harry Potter series 50%</p></div>",
            "Suzanne Collins||<div class='image' data-wallpaper='http://upload.wikimedia.org/wikipedia/en/a/ab/Hunger_games.jpg'></div><div class='text'><p>Hunger Games 5% discount</p></div>",
            "Angry Birds||<div class='image' data-wallpaper='http://mcdn4.angrybirdsnest.com/wp-content/uploads/2011/12/Angry-Birds-Seasons-Christmas-Comic-Part-25.jpg'></div><div class='text'><p>Buy Angry Birds and get a free Angry X-Mas bird card</p></div>"];
        var selected_promotions = [];
        selected_promotions.push(all_promotions[0]);

        all_promotions.data.forEach(function(item) {
            console.log(item.name);
        })



        console.log(selected_promotions);
    }
</script>

<!-- Header -->
<header class="stripe full">
    <!-- <a href="#" class="navigation-trigger icon-menu"></a> -->
    <div class="contain">
        <div class="text-center-tight">
            <div class="inner">
                <img id="logo" src="images/999.png" alt="No image found."/>
                <br/>
                <h2>Hey there!</h2>
                <br/>
                <h5 style="color: white;">Welcome to Walmart Guadalajara! Please log in with Facebook to get free internet access.</h5>
                <br/>
                <fb:login-button scope="public_profile,email,user_likes" onlogin="checkLoginState();">
                </fb:login-button>

                <div id="status" style="color: white;">
                </div>
            </div>
        </div>
        <!-- <a href="#" class="scroll-down icon-angle-down"></a> -->
    </div>
    <div class="bg-image"></div>
</header>

<!-- Footer -->
<div class="stripe dark padding-3" id="footer">
    <div class="contain text-center">
        <p style="font-size: 12px; font-family: Helvetica, 'Trebuchet MS', sans-serif">See our <a href="ap.php">Privacy Policy</a>.</p>
        <h5>Enera Free WiFi</h5>
    </div>
</div>
</body>
</html>


---- showcase antiguo
<!-- Showcase -->
<div id="showcase-container" class="stripe" id="stripe-showcase" style="display: none;">
    <div class="contain">
        <h3>You might be interested in these products:</h3>
        <div id="promotions_containerx" class="showcase-list">
            <?php
            foreach ($selected_promotions as $promotion)
            {
                echo "<a href='#' class='showcase'>";
                echo $promotion;
                echo "</a>";
            }
            ?>
        </div>
    </div>
</div>



----- survey antiguo



<?php
//Start of controller
$_SESSION['type'] = "survey";

$company_views = "company_views"; //FIXME: This should be on a const file
$str_sv = "sv";
$id_view = "";
$filter = ""; //Assume empty filter

if ($stmt = $mysqli->prepare("SELECT `view_data`, `id`, `filter` FROM $company_views WHERE `id_branch` = ? AND `data_type` = ?")) {
    $stmt->bind_param("is", $id_branch, $str_sv);
    $stmt->execute();
    $stmt->bind_result($view_data, $id_view, $filter);

    $cont = 0;
    while ($stmt->fetch()) {
        $survey[$cont] = array(
            "view_data" => $view_data,
            "id_view" => $id_view,
            "filter" => $filter,
        );
        $cont++;
    }

    $stmt->close();
} else {
    trigger_error($mysqli->error, E_USER_ERROR);
}

//TODO: Get the appropiate survey to show
$client_date = getdate();
$client_day = $client_date['wday'];
$client_hour = 1 << (HOUR_BIT_SHIFTER + $client_date['hours']);

$client_recurrent = 0; //TODO: Define this value

if ($fb_gender == 'female') {
    $client_gender = FEMALE_BIT;
} else if ($fb_gender == 'male') {
    $client_gender = MALE_BIT;
}

$current_filter = $client_day | $client_hour | $client_gender; //TODO: Add the other filters gender | recurrent | etc

$best_match = 0;
$highest_match = 0;

for ($i = 0; $i < count($survey); $i++)
{
    //echo $i . " operation " . $current_filter . " & " . $survey[$i]['filter'] . " scores " . ($current_filter & $survey[$i]['filter']);
    //echo "<br/>";

    //$select_random_survey = true; //TODO: Implement a way to select a random survey

    if ($current_filter & $survey[$i]['filter'])
    {
        $bit_count = getBitCount($survey[$i]['filter']);
        if ($bit_count > $highest_match)
        {
            $highest_match = $bit_count;
            $best_match = $i;
        }
        //echo $i . " operation " . $current_filter . " & " . $survey[$i]['filter'] . " score " . $bit_count . "\n";
    }
}

$survey_answers = "survey_answers"; //FIXME: This should be on a const file
$id_view = "";

if ($stmt = $mysqli->prepare("SELECT `id_view` FROM $survey_answers WHERE `id_branch` = ? AND `user_mac` = ?")) {
    $stmt->bind_param("is", $id_branch, $client_mac);
    $stmt->execute();
    $stmt->bind_result($id_view);

    $cont = 0;
    while ($stmt->fetch()) {
        $answered_surveys[$cont] = array(
            "id_view" => $id_view,
        );
        $cont++;
    }

    $stmt->close();
} else {
    trigger_error($mysqli->error, E_USER_ERROR);
}

$select_random_survey = false;
for ($q = 0; $q < count($answered_surveys); $q++) {
    //echo $answered_surveys[$q]['id_view'];
    if ($survey[$best_match]['id_view'] == $answered_surveys[$q]['id_view']) {
        $select_random_survey = true;
    }
}

if ($select_random_survey) {
    $random_survey = rand(0, count($survey) - 1);
    //echo "selecting random survey $random_survey";
    $data_object = json_decode(utf8_encode($survey[$random_survey]['view_data']));
    $_SESSION['id_view'] = $survey[$random_survey]['id_view'];
} else {
    //echo "selecting best match";
    $data_object = json_decode(utf8_encode($survey[$best_match]['view_data']));
    $_SESSION['id_view'] = $survey[$best_match]['id_view'];
}

$mysqli->close();

//End of controller
?>
<!-- Header with the like box -->
<?php /*include 'page/section/header_like.php';*/ ?>

<!-- <div class="stripe enera-blue-bg">
    <div class="text-center">
        <h3>Para navegar en internet por favor contesta esta breve encuesta:</h3>
    </div>
</div> -->

<!-- <header class="stripe full fixed-height">
    <div class="contain">
        <div class="text-center-tight">
            <br/>
            <br/>
            <div class="row">
                <div class="span-3">
                    <img id="logo" src="images/599.png" alt="No image found."/>
                </div>
                <div class="span-6">
                    <h2>Para tener internet por favor contesta la siguiente encuesta rápida.</h2>
                </div>
                <div class="span-3">
                    <a id="scroller-down" href="#" class="scroll-down"><i class="fa fa-arrow-down"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-image"></div>
</header> -->

<header class="stripe full fixed-height">
    <!-- <a href="#" class="navigation-trigger icon-menu"></a> -->
    <div class="contain">
        <div class="text-center-tight">
            <div class="inner">
                <!-- <img id="logo" src="images/599.png" alt="No image found."/> -->
                <br/>
                <h5>Por favor contesta la siguiente encuesta rápida para tener internet.</h5>
                <br/>
            </div>
        </div>
        <!-- <a href="#" class="scroll-down icon-angle-down"></a> -->
    </div>
    <div class="bg-image"></div>
    <a id="scroller-down" href="#" class="scroll-down"><i class="fa fa-arrow-down"></i></a>
</header>

<!-- Test showcase -->
<div class="stripe">
    <div class="container">
        <div class="not_connected">
            <form action="save_survey.php" method="POST">
                <input type="hidden" name="success_url" value="<?= $success_url ?>"/>
                <!-- TODO: Erase tr's and td's -->
                <div>
                    <div id='checkboxes-container'>
                        <div class="question-1">
                            <br/>
                            <h5 class="title"><?= $data_object->{'question-1'}[0] ?></h5>
                            <input type="hidden" name="entry1-title" value="<?= $data_object->{'question-1'}[0] ?>"/>
                            <?php
                            $count = count($data_object->{'question-1'});
                            for ($item = 1; $item < $count; $item++) {
                                $option = $data_object->{'question-1'}[$item];
                                if ($option) {
                                    echo "<div class='formplate radio-inline big-radio interaction-$item'>";
                                        echo "<input class='icheck' type='radio' name='entry1-answer' value='". $option ."' id='". $option ."'/>";
                                        echo "<label for='" . $option . "' name='text'>$option</span>";
                                    echo "</div>";
                                    echo "<br/>";
                                }
                            }
                            ?>
                        </div>
                        <div class="question-2">
                            <br/>
                            <h5 class="title"><?= $data_object->{'question-2'}[0] ?></h5>
                            <input type="hidden" name="entry2-title" value="<?= $data_object->{'question-2'}[0] ?>"/>
                            <?php
                            $count = count($data_object->{'question-2'});
                            for ($item = 1; $item < $count; $item++) {
                                $option = $data_object->{'question-2'}[$item];
                                if ($option) {
                                    echo "<div class='formplate radio-inline big-radio interaction-$item'>";
                                        echo "<input class='icheck' type='radio' name='entry2-answer' value='". $option ."' id='". $option ."'/>";
                                        echo "<label for='" . $option . "' name='text'>$option</span>";
                                    echo "</div>";
                                    echo "<br/>";
                                }
                            }
                            ?>
                        </div>
                        <div class="question-3">
                            <br/>
                            <h5 class="title"><?= $data_object->{'question-3'}[0] ?></h5>
                            <input type="hidden" name="entry3-title" value="<?= $data_object->{'question-3'}[0] ?>"/>
                            <?php
                            $count = count($data_object->{'question-3'});
                            for ($item = 1; $item < $count; $item++) {
                                $option = $data_object->{'question-3'}[$item];
                                if ($option) {
                                    echo "<div class='formplate radio-inline big-radio interaction-$item'>";
                                        echo "<input class='icheck' type='radio' name='entry3-answer' value='". $option ."' id='". $option ."'/>";
                                        echo "<label for='" . $option . "' name='text'>$option</span>";
                                    echo "</div>";
                                    echo "<br/>";
                                }
                            }
                            ?>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="text-center">
                        <br/>
                        <br/>
                        <button id='send-survey' type="submit" class="btn-download" style="width: 300px; display: none;">Navegar en Internet</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- <div class="stripe">
    <div class="text-center">
        <h5>Regálanos un like:</h5>
        <div class="fb-like-box" data-href="https://www.facebook.com/pages/Punto-M%C3%A9xico/442308712577566" data-width="200" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="false" data-show-border="false"></div>
    </div>
</div> -->

<!-- Footer -->
<?php include 'page/section/footer.php'; ?>

<script>
    var theParent = document.getElementById('checkboxes-container');
    theParent.addEventListener("click", doSomething, false);

    function doSomething(event) {
        if (theParent.getElementsByClassName('checked').length >= 3) {
            document.getElementById('send-survey').style.display = ''; //Show the button by removing the "display: none;" rule
        }
        event.stopPropagation();
    }
</script>





---- working old template for video

<?php
//Start of controller
$_SESSION['type'] = "video";

$video_path = 'test';

//End of controller
?>

<!-- Header with the like box -->
<?php include 'page/section/header_like.php'; ?>

<div id='showcase-container' class="stripe">
    <h3>Video promocional:</h3>

    <div>
        <div class='row'>
            <div class='span-1'><p></p></div>
            <div class='span-10'>
                <video id="video" class="video-js vjs-default-skin" controls preload="true" width="100%" height="350" poster="videos/<?= $video_path ?>-poster.jpg" data-setup='{}'>
                    <source src="videos/<?= $video_path ?>.mp4" type='video/mp4'>
                    <p class="vjs-no-js">
                        To view this video please enable JavaScript, and consider upgrading to a web browser
                        that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                    </p>
                </video>
            </div>
            <div class='span-1'><p></p></div>
        </div>
        <div>
            <br/>
            <br/>
            <div id='countdown'></div>
            <button id='send-survey' type="submit" class="btn-download" style="width: 300px; display: none;">Navegar en Internet</button>
        </div>
    </div>
</div>

<!-- Footer -->
<?php include 'page/section/footer.php'; ?>

<script>
    var player = videojs('video', { /* Options */ }, function() {
        this.play(); // if you don't trust autoplay for some reason
        // How about an event listener?
        this.on('ended', function() {
            document.getElementById('send-survey').style.display = ''; //Show the button by removing the "display: none;" rule
        });
    });

    //Timer functionality, uncomment to enable seeing only X seconds of a video after showing the button
    /*
     var interval;
     var minutes = 0;
     var seconds = 10;
     window.onload = function() {
     countdown('countdown');
     }

     function countdown(element) {
     interval = setInterval(function() {
     var el = document.getElementById(element);
     if(seconds == 0) {
     if(minutes == 0) {
     document.getElementById('send-survey').style.display = ''; //Show the button by removing the "display: none;" rule
     document.getElementById('countdown').style.display = 'none';
     clearInterval(interval);
     return;
     } else {
     minutes--;
     seconds = 60;
     }
     }
     if(minutes > 0) {
     var minute_text = minutes + (minutes > 1 ? 'minutos' : 'minutos');
     } else {
     var minute_text = '';
     }
     var second_text = seconds > 1 ? 'segundos' : 'segundo';
     el.innerHTML = 'Podrás navegar en internet en ' + minute_text + ' ' + seconds + ' ' + second_text;
     seconds--;
     }, 1000);
     }*/
</script>






------ old working banner.php with changes madewhen pasted here


<?php
//Start of controller

$_SESSION['type'] = "banner";

$str_bn = 'bn'; //TODO: Change to a constant files
$id_branch = 576; //TODO: Replace with the actual value

$id_view = 0;
$view_data = '';
$filter = '';

if ($stmt = $mysqli->prepare("SELECT `id`, `view_data`, `filter` FROM `company_views` WHERE `id_branch` = ? AND `data_type` = ?")) {
    $stmt->bind_param("is", $id_branch, $str_bn);
    $stmt->execute();
    $stmt->bind_result($id_view, $view_data, $filter);
    $stmt->fetch();
    $stmt->close();
} else {
    trigger_error($mysqli->error, E_USER_ERROR);
}

$view_data = json_decode($view_data);
$banner = $view_data->content;

//End of controller
?>
<!-- Header with the like box -->
<?php include 'page/section/header_like.php'; ?>

<!-- Test showcase -->
<div id='showcase-container' class="stripe">
    <h3>Anuncio de nuestros patrocinadores:</h3>
    <div id="promotions_container" class="row">
        <?= $banner ?>
    </div>
</div>

<!-- Footer -->
<?php include 'page/section/footer.php'; ?>



--------------- bn de db ------------

<div class=''single-promotion''><img src=''http://mcdn4.angrybirdsnest.com/wp-content/uploads/2011/12/Angry-Birds-Seasons-Christmas-Comic-Part-25.jpg''/><p style=''font-size: 15px;''>Descuento 20% en la compra de angry Birds</p></div>


---------------- ppart of the banner portal when it uploads images ---------------
<!-- <a href="<?= /*$link_href*/ ?>"><img src="images/<?= /*$link_url*/ ?>" style="max-height: 350px;"/></a> -->




--------------- fb.init temportal -----------------
FB.init({
            appId: '282363058604879',
            cookie: true,
            xfbml: true,
            status: false,
            version: 'v2.1'
        });




--------- antiguo login por medio de php -----------
<a href="<?= $loginUrl ?>" class="btn-facebook btn-auth">Login con Facebook</a>